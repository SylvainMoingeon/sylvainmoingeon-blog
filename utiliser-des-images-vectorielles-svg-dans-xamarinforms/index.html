<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>Utiliser des images vectorielles SVG dans Xamarin.Forms - Sylvain Moingeon </title>
        <meta name="description" content="Comment utiliser des images vectorielles SVG sous Xamarin.Forms sans Skiasharp ni aucune autre librairie tierce." />
        
        <meta name="generator" content="Publii Open-Source CMS for Static Site" />

        <link rel="canonical" href="https://www.sylvainmoingeon.fr/utiliser-des-images-vectorielles-svg-dans-xamarinforms/">
        
        <link rel="alternate" type="application/atom+xml" href="https://www.sylvainmoingeon.fr/feed.xml" />
<link rel="alternate" type="application/json" href="https://www.sylvainmoingeon.fr/feed.json" />

        <meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@SylvainMoingeon" /><meta name="twitter:title" content="Utiliser des images vectorielles SVG dans Xamarin.Forms" /><meta name="twitter:description" content="Comment utiliser des images vectorielles SVG sous Xamarin.Forms sans Skiasharp ni aucune autre librairie tierce." /><meta name="twitter:image" content="https://www.sylvainmoingeon.fr/media/posts/39/cover_svg.png" />
		<!-- Fontawesome -->
		<link href="https://www.sylvainmoingeon.fr/assets/fontawesome/css/all.css" rel="stylesheet"> 
    <!-- Prism (syntax highlighting) -->
    <link rel="stylesheet" href="https://www.sylvainmoingeon.fr/assets/css/prism.css">

	        <link rel="shortcut icon" href="https://www.sylvainmoingeon.fr/media/website/favicon.png" type="image/png" />
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
        <link href="https://fonts.googleapis.com/css?family=DM+Sans:400,700&display=swap&subset=latin-ext" rel="stylesheet">
        <style>:root{--body-font:'DM Sans',sans-serif;--heading-font:var(--body-font);--post-entry-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style>
        <link rel="stylesheet" href="https://www.sylvainmoingeon.fr/assets/css/style.css?v=495aa24cb5af158054fa2e3ec3741a9a">
        <script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sylvainmoingeon.fr/utiliser-des-images-vectorielles-svg-dans-xamarinforms/"},"headline":"Utiliser des images vectorielles SVG dans Xamarin.Forms","datePublished":"2020-11-17T15:55","dateModified":"2020-11-18T11:51","image":{"@type":"ImageObject","url":"https://www.sylvainmoingeon.fr/media/posts/39/cover_svg.png","height":1080,"width":1920},"description":"Comment utiliser des images vectorielles SVG sous Xamarin.Forms sans Skiasharp ni aucune autre librairie tierce.","author":{"@type":"Person","name":"Sylvain","url":"https://www.sylvainmoingeon.fr/auteurs/sylvain/"},"publisher":{"@type":"Organization","name":"Sylvain"}}</script>
        
        
		
    <script>
             
      function addEmailAddresses(){     
      document.querySelectorAll('.email').forEach(function(linkElement) {
      
        var domainname = window.atob("c3lsdmFpbm1vaW5nZW9uLmZy");
        var username = window.atob(linkElement.getAttribute("id"));
        var emailaddress = username + "@" + domainname;
        var mailto = window.atob("bWFpbHRv");  // mailto:
        //linkElement.innerHTML = emailaddress;
        linkElement.setAttribute("href", mailto + ":" + emailaddress + "?subject=[Contact%20site%20web]");
      });      
    }
            
    </script>

	    </head>
    <body onload="addEmailAddresses()" class="line-numbers">
        



<div class="container">
   <header class="top" id="js-top">
      <div>
         <a class="logo" href="https://www.sylvainmoingeon.fr/">
               Sylvain Moingeon
         </a>

               <nav class="navbar">
                  <button
                     class="navbar__toggle"
                     aria-label="Menu"
                     aria-haspopup="true"
                     aria-expanded="false">
                     <span class="navbar__toggle-box">
                        <span class="navbar__toggle-inner">Menu</span>
                     </span>
                  </button>
                <ul class="navbar__menu">
                         <li>
                           <a
                              href="https://www.sylvainmoingeon.fr/"
                                 target="_self"
            >
                              Accueil
                          </a>
            
                     </li>
                         <li>
                           <a
                              href="https://www.sylvainmoingeon.fr/contact/"
                                 target="_self"
            >
                              Contact
                          </a>
            
                     </li>
                </ul>
               </nav>

            <div class="search">
               <div class="search__overlay js-search-overlay">
                  <div class="search__overlay-inner">
                     <form action="https://www.sylvainmoingeon.fr/search.html" class="search__form">
                        <input
                           class="search__input js-search-input"
                           type="search"
                           name="q"
                           placeholder="chercher..."
                           aria-label="Search input"
                           autofocus="autofocus"/>
                     </form>
                     <button
                        class="search__close js-search-close"
                        aria-label="Fermer">
                        Fermer
                     </button>
                  </div>
               </div>
               <button
                  class="search__btn js-search-btn"
                  aria-label="Search">
                  <svg role="presentation" focusable="false" height="15px" width="15px">
                     <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#search"/>
                  </svg>
               </button>
            </div>          

         </div>
      </header>
<main>
      <article class="post wrapper">
         <div class="hero hero--narrow">
            <header>
                     <p>
                        <a href="https://www.sylvainmoingeon.fr/tags/xamarinforms/" title="">Xamarin.Forms</a>
                     </p>                    
               <h1>
                  Utiliser des images vectorielles SVG dans Xamarin.Forms
               </h1>
                  <address>
                     par
                        <a href="https://www.sylvainmoingeon.fr/auteurs/sylvain/" rel="author">Sylvain</a>
                  </address>
                  publié le
                  <time datetime="2020-11-17T15:55">
                        mardi 17 novembre 2020
                  </time>
            </header>
                  <figure class="hero__image post__featured-image">
                     <img
                        src="https://www.sylvainmoingeon.fr/media/posts/39/cover_svg.png"
                            srcset="https://www.sylvainmoingeon.fr/media/posts/39/responsive/cover_svg-xs.png 300w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/cover_svg-sm.png 480w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/cover_svg-md.png 768w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/cover_svg-lg.png 1024w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/cover_svg-xl.png 1360w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/cover_svg-2xl.png 1600w" sizes="(max-width: 1600px) 100vw, 1600px"
                         loading="eager"
                        height="1080"
                        width="1920"
                        alt="">
                      
                        <figcaption>
                           
                           Image par krzysztof-m de Pixabay
                        </figcaption>                      
                  </figure>
         </div>
         <div class="post__entry">            
            
  <p>
    Il est possible de longue date d'utiliser des bibliothèques tierces telles que <a href="https://github.com/mono/SkiaSharp" target="_blank">Skiasharp</a> pour afficher des images vectorielles dans <a href="https://www.sylvainmoingeon.fr/tags/xamarinforms/">Xamarin.Forms</a>.&nbsp;Mais quand on est soucieux de la légèreté et des performances de son application, il est souvent préférable de se limiter aux fonctionnalités proposées par défaut par notre plateforme de développement.
  </p>

  <p>
    Depuis l'apparition des <code>Path</code> avec la version 4.8, Xamarin.Forms est en mesure d'utiliser d'afficher des images vectorielles sans l'aide d'aucun autre package !
  </p>

  <p>
    Je vous montre comment ça se path... euh... passe ?
  </p>
<hr class="separator separator--dots" />

    <h2 id="convertir-le-contenu-dun-svg-en-path">
      Convertir le contenu d'un SVG en Path
    </h2>

  <p class="msg msg--info">
    Les fonctionnalités utilisées dans cet article nécessitent Xamarin.Forms 5.0 ou au minimum Xamarin.Forms 4.8 avec le flag expérimental :&nbsp;<code>Device.SetFlags(new string[] { "Shapes_Experimental" });</code> dans le constructeur de la classe <code>App</code>
  </p>

  <p>
    Alors oui, je vous ai un tout petit peu menti. On ne peut toujours pas incorporer un fichier svg et l'utiliser comme ressource. Mais un fichier svg n'étant que du texte balisé en XML, il est très facile d'en extraire le contenu et d'en faire une forme dans Xamarin.Form.
  </p>

  <p>
    Nous prendrons deux exemples : un cas simple où l'image est constituée d'un seul chemin et un cas plus complexe où l'image est composée de plusieurs chemins.
  </p>

  <p>
    Nous verrons ensuite comment rendre une image vectorielle réutilisable facilement dans le code sans duplication à l'aide des <code>Styles</code>.
  </p>

    <h3 id="image-simple-compose-dun-seul-chemin">
      Image simple composée d'un seul chemin
    </h3>

  <p>
    Nous allons partir de ce svg très simple représentant un avion :
  </p>

    <figure class="post__image post__image--center">
      <img decoding="async" loading="lazy" src="https://www.sylvainmoingeon.fr/media/posts/39/airport.svg" height="64" width="64" alt="Une image vectorielle simple" >
      <figcaption>Une image vectorielle simple</figcaption>
    </figure>

  <p>
    Si vous ouvrez le fichier avec un éditeur de texte, vous y trouverez ceci :
  </p>
<pre class="line-numbers  language-html"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;svg enable-background="new 0 0 64 64" version="1.1" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"&gt;
    &lt;path d="M15,6.8182L15,8.5l-6.5-1 l-0.3182,4.7727L11,14v1l-3.5-0.6818L4,15v-1l2.8182-1.7273L6.5,7.5L0,8.5V6.8182L6.5,4.5v-3c0,0,0-1.5,1-1.5s1,1.5,1,1.5v2.8182 L15,6.8182z"/&gt;
&lt;/svg&gt;
</code></pre>

  <p>
    Ce qui nous intéresse ici, c'est la balise <code>path</code> et en particulier son attribut <code>d</code> contenant le tracé du dessin. Nous allons simplement copier le contenu de <code>d</code> dans la propriété <code>Data</code> d'un <code>Path</code> Xamarin.Forms. Comme ceci :&nbsp;
  </p>
<pre class="line-numbers  language-html"><code>&lt;Path Aspect="Uniform"
      Data="M15,6.8182L15,8.5l-6.5-1 l-0.3182,4.7727L11,14v1l-3.5-0.6818L4,15v-1l2.8182-1.7273L6.5,7.5L0,8.5V6.8182L6.5,4.5v-3c0,0,0-1.5,1-1.5s1,1.5,1,1.5v2.8182 L15,6.8182z"
      Fill="Black"
      HeightRequest="64"  /&gt;</code></pre>

  <p>
    La propriété <code>Aspect</code> avec la valeur <code>Uniform</code> conserve les proportions de l'image. La propriété <code>Fill</code> indique la couleur de remplissage de la forme.
  </p>

  <p>
    Sans entrer trop loin dans les détails, il est très facile de manipuler l'image, par exemple en modifier le contour, le remplissage ou lui appliquer des transformations.
  </p>

  <p>
    La même image vectorielle agrandie x2, pivotée de 45° avec un fond vert et un contour pointillé noir.
  </p>
<pre class="line-numbers  language-html"><code>&lt;Path Aspect="Uniform"
      Data="M15,6.8182L15,8.5l-6.5-1 l-0.3182,4.7727L11,14v1l-3.5-0.6818L4,15v-1l2.8182-1.7273L6.5,7.5L0,8.5V6.8182L6.5,4.5v-3c0,0,0-1.5,1-1.5s1,1.5,1,1.5v2.8182 L15,6.8182z"            
      Fill="Green"
      HeightRequest="64"
      Rotation="45"
      Stroke="Black"
      Scale="2"
      StrokeDashArray="2 1"
      StrokeThickness="2" /&gt;</code></pre>

  <p>
    Le résultat sous Android :<br>
  </p>

    <figure class="post__image post__image--center">
      <img decoding="async" loading="lazy" src="https://www.sylvainmoingeon.fr/media/posts/39/screenshot-svg-simple-2.png" height="295" width="355" alt="Une image vectorielle, affichée et manipulée dans Xamarin.Forms"  sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-simple-2-xs.png 300w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-simple-2-sm.png 480w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-simple-2-md.png 768w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-simple-2-lg.png 1024w">
      <figcaption>Une image vectorielle, affichée et manipulée dans Xamarin.Forms</figcaption>
    </figure>

    <h3 id="image-complexe-compose-de-plusieurs-chemins">
      Image complexe composée de plusieurs chemins
    </h3>

  <p>
    Malheureusement, les images vectorielles ne sont pas toujours aussi simples et sont parfois composées de plusieurs chemins. Par exemple celle-ci :
  </p>

    <figure class="post__image post__image--center">
      <img decoding="async" loading="lazy" src="https://www.sylvainmoingeon.fr/media/posts/39/car.svg" height="512" width="512" alt="" >
      
    </figure>
<pre class="line-numbers  language-html"><code>&lt;?xml version="1.0"?&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"&gt;
    &lt;path d="M104,320a24,24,0,1,0,24,24A24.028,24.028,0,0,0,104,320Zm0,32a8,8,0,1,1,8-8A8.009,8.009,0,0,1,104,352Z"/&gt;
    &lt;path d="M408,320a24,24,0,1,0,24,24A24.028,24.028,0,0,0,408,320Zm0,32a8,8,0,1,1,8-8A8.009,8.009,0,0,1,408,352Z"/&gt;
    &lt;path d="M488,304V256a48.051,48.051,0,0,0-48-48H373.54l-22-58.68A43.052,43.052,0,0,0,310.7,120H160a43.044,43.044,0,0,0-40.72,28.97L90.96,208H72a48.051,48.051,0,0,0-48,48v48A16.021,16.021,0,0,0,8,320v16a16.021,16.021,0,0,0,16,16H48.58a55.994,55.994,0,0,0,110.84,0H352.58a55.994,55.994,0,0,0,110.84,0H488a16.021,16.021,0,0,0,16-16V320A16.021,16.021,0,0,0,488,304ZM356.46,208H256V160h82.46ZM40,264H56v8H40Zm8.58,72H24V320H53.41A55.5,55.5,0,0,0,48.58,336ZM104,384a40,40,0,1,1,40-40A40.04,40.04,0,0,1,104,384Zm248.58-48H159.42a55.5,55.5,0,0,0-4.83-16H357.41A55.5,55.5,0,0,0,352.58,336ZM408,384a40,40,0,1,1,40-40A40.04,40.04,0,0,1,408,384Zm40-80a7.337,7.337,0,0,0-.81.05,55.871,55.871,0,0,0-78.37-.01A7.383,7.383,0,0,0,368,304H144a7.383,7.383,0,0,0-.82.04,55.871,55.871,0,0,0-78.37.01A7.337,7.337,0,0,0,64,304H40V288H64a8,8,0,0,0,8-8V256a8,8,0,0,0-8-8H41.01A32.058,32.058,0,0,1,72,224H96a8,8,0,0,0,7.21-4.54l30.71-64a7.5,7.5,0,0,0,.37-.93A27.079,27.079,0,0,1,160,136H310.7a27.027,27.027,0,0,1,19.22,8H160a8,8,0,0,0-8,8v64a8,8,0,0,0,8,8H440a32.058,32.058,0,0,1,30.99,24H448a8,8,0,0,0-8,8v24a8,8,0,0,0,8,8h24v16ZM240,160v48H168V160ZM472,264v8H456v-8Zm16,72H463.42a55.5,55.5,0,0,0-4.83-16H488Z"/&gt;
    &lt;path d="M256,248h40a8,8,0,0,0,0-16H256a8,8,0,0,0,0,16Z"/&gt;
&lt;/svg&gt;
</code></pre>

  <p>
    Malheur ! l'image contient plusieurs chemins mais notre objet <code>Path</code> n'a qu'une seule propriété <code>Data</code> ! Comment faire ?
  </p>

  <p>
    Heureusement, la propriété <code>Data</code> de notre <code>Path</code> peut contenir bien plus qu'une simple chaîne de caractère, notamment un groupe de géométrie. Nous allons donc créer un <code>GeometryGroup</code> contenant des <code>PathGeometry</code> dont nous renseigneront la propriété <code>Figures</code>.
  </p>

  <p>
    Chaque path de notre svg alimente ainsi les propriétés <code>Figures</code> de nos <code>PathGeometry</code> :
  </p>
<pre class="line-numbers  language-html"><code>&lt;Path Aspect="Uniform"
      Fill="Black"
      HeightRequest="64"&gt;
    &lt;Path.Data&gt;
        &lt;GeometryGroup&gt;
            &lt;PathGeometry Figures="M104,320a24,24,0,1,0,24,24A24.028,24.028,0,0,0,104,320Zm0,32a8,8,0,1,1,8-8A8.009,8.009,0,0,1,104,352Z" /&gt;
            &lt;PathGeometry Figures="M408,320a24,24,0,1,0,24,24A24.028,24.028,0,0,0,408,320Zm0,32a8,8,0,1,1,8-8A8.009,8.009,0,0,1,408,352Z" /&gt;
            &lt;PathGeometry Figures="M488,304V256a48.051,48.051,0,0,0-48-48H373.54l-22-58.68A43.052,43.052,0,0,0,310.7,120H160a43.044,43.044,0,0,0-40.72,28.97L90.96,208H72a48.051,48.051,0,0,0-48,48v48A16.021,16.021,0,0,0,8,320v16a16.021,16.021,0,0,0,16,16H48.58a55.994,55.994,0,0,0,110.84,0H352.58a55.994,55.994,0,0,0,110.84,0H488a16.021,16.021,0,0,0,16-16V320A16.021,16.021,0,0,0,488,304ZM356.46,208H256V160h82.46ZM40,264H56v8H40Zm8.58,72H24V320H53.41A55.5,55.5,0,0,0,48.58,336ZM104,384a40,40,0,1,1,40-40A40.04,40.04,0,0,1,104,384Zm248.58-48H159.42a55.5,55.5,0,0,0-4.83-16H357.41A55.5,55.5,0,0,0,352.58,336ZM408,384a40,40,0,1,1,40-40A40.04,40.04,0,0,1,408,384Zm40-80a7.337,7.337,0,0,0-.81.05,55.871,55.871,0,0,0-78.37-.01A7.383,7.383,0,0,0,368,304H144a7.383,7.383,0,0,0-.82.04,55.871,55.871,0,0,0-78.37.01A7.337,7.337,0,0,0,64,304H40V288H64a8,8,0,0,0,8-8V256a8,8,0,0,0-8-8H41.01A32.058,32.058,0,0,1,72,224H96a8,8,0,0,0,7.21-4.54l30.71-64a7.5,7.5,0,0,0,.37-.93A27.079,27.079,0,0,1,160,136H310.7a27.027,27.027,0,0,1,19.22,8H160a8,8,0,0,0-8,8v64a8,8,0,0,0,8,8H440a32.058,32.058,0,0,1,30.99,24H448a8,8,0,0,0-8,8v24a8,8,0,0,0,8,8h24v16ZM240,160v48H168V160ZM472,264v8H456v-8Zm16,72H463.42a55.5,55.5,0,0,0-4.83-16H488Z" /&gt;
            &lt;PathGeometry Figures="M256,248h40a8,8,0,0,0,0-16H256a8,8,0,0,0,0,16Z" /&gt;
        &lt;/GeometryGroup&gt;
    &lt;/Path.Data&gt;
&lt;/Path&gt;
</code></pre>

  <p>
    Et hop :
  </p>

    <figure class="post__image post__image--center">
      <img decoding="async" loading="lazy" src="https://www.sylvainmoingeon.fr/media/posts/39/screenshot-svg-complexe.png" height="132" width="353" alt=""  sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-complexe-xs.png 300w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-complexe-sm.png 480w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-complexe-md.png 768w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-complexe-lg.png 1024w">
      
    </figure>

  <p>
    Nous voilà capable d'afficher des images vectorielles simples ou complexes directement dans Xamarin.Forms. Mais pour l'instant, cela reste fastidieux : pour utiliser une même image à plusieurs endroits, il reste nécessaire de copier-coller tout le contenu du <code>Path</code> à chaque fois.&nbsp;
  </p>

  <p id="voyons-comment-rsoudre-ce-problme-avec-style-">
    Voyons comment résoudre ce problème avec Style !
  </p>

    <h2 id="crer-une-image-vectorielle-rutilisable-grce-aux-styles">
      Créer une image vectorielle réutilisable grâce aux styles
    </h2>

  <p>
    Nous allons créer un&nbsp;<code>ResourceDictionary</code> pour y placer des <code>Styles</code> définissant le tracé de chaque image vectorielle.<resourcedictionary <br=""></resourcedictionary>
  </p>

  <p>
    Toutes nos images SVG auront des propriétés communes, nous allons donc commencer par créer un style de base :
  </p>
<pre class="line-numbers  language-html"><code>&lt;Style x:Key="BaseSVGStyle" TargetType="Path"&gt;
    &lt;Setter Property="Aspect" Value="Uniform" /&gt;
    &lt;Setter Property="Fill" Value="Black" /&gt;
&lt;/Style&gt;</code></pre>

  <p>
    Nous allons ensuite créer un style par image héritant de <code>BaseSVGStyle</code>&nbsp;à l'aide de la propriété <code>BasedOn</code>. Voici un exemple :
  </p>
<pre class="line-numbers  language-html"><code>&lt;Style x:Key="PlaneSVG"
        BasedOn="{StaticResource BaseSVGStyle}"
        TargetType="Path"&gt;
    &lt;Setter Property="Data" Value="m430.37 48.711c29.15-29.153-11.17-67.267-39.96-38.479l-106.3 106.3-243.52-64.372-40.59 40.595 200.71 105.71-81.18 81.17-63.104-7.75-32.106 32.11 71.595 37.64 37.645 71.6 32.1-32.11-7.38-62.74 81.18-81.17 103.43 199.39 40.6-40.6-61.63-238.58 108.51-108.71z" /&gt;
    &lt;Setter Property="HeightRequest" Value="64" /&gt;
&lt;/Style&gt;
    
&lt;Style x:Key="CarSVG"
        BasedOn="{StaticResource BaseSVGStyle}"
        TargetType="Path"&gt;
    &lt;Setter Property="HeightRequest" Value="32" /&gt;
    &lt;Setter Property="Data"&gt;
        &lt;Setter.Value&gt;
            &lt;GeometryGroup&gt;
                &lt;PathGeometry Figures="M104,320a24,24,0,1,0,24,24A24.028,24.028,0,0,0,104,320Zm0,32a8,8,0,1,1,8-8A8.009,8.009,0,0,1,104,352Z" /&gt;
                &lt;PathGeometry Figures="M408,320a24,24,0,1,0,24,24A24.028,24.028,0,0,0,408,320Zm0,32a8,8,0,1,1,8-8A8.009,8.009,0,0,1,408,352Z" /&gt;
                &lt;PathGeometry Figures="M488,304V256a48.051,48.051,0,0,0-48-48H373.54l-22-58.68A43.052,43.052,0,0,0,310.7,120H160a43.044,43.044,0,0,0-40.72,28.97L90.96,208H72a48.051,48.051,0,0,0-48,48v48A16.021,16.021,0,0,0,8,320v16a16.021,16.021,0,0,0,16,16H48.58a55.994,55.994,0,0,0,110.84,0H352.58a55.994,55.994,0,0,0,110.84,0H488a16.021,16.021,0,0,0,16-16V320A16.021,16.021,0,0,0,488,304ZM356.46,208H256V160h82.46ZM40,264H56v8H40Zm8.58,72H24V320H53.41A55.5,55.5,0,0,0,48.58,336ZM104,384a40,40,0,1,1,40-40A40.04,40.04,0,0,1,104,384Zm248.58-48H159.42a55.5,55.5,0,0,0-4.83-16H357.41A55.5,55.5,0,0,0,352.58,336ZM408,384a40,40,0,1,1,40-40A40.04,40.04,0,0,1,408,384Zm40-80a7.337,7.337,0,0,0-.81.05,55.871,55.871,0,0,0-78.37-.01A7.383,7.383,0,0,0,368,304H144a7.383,7.383,0,0,0-.82.04,55.871,55.871,0,0,0-78.37.01A7.337,7.337,0,0,0,64,304H40V288H64a8,8,0,0,0,8-8V256a8,8,0,0,0-8-8H41.01A32.058,32.058,0,0,1,72,224H96a8,8,0,0,0,7.21-4.54l30.71-64a7.5,7.5,0,0,0,.37-.93A27.079,27.079,0,0,1,160,136H310.7a27.027,27.027,0,0,1,19.22,8H160a8,8,0,0,0-8,8v64a8,8,0,0,0,8,8H440a32.058,32.058,0,0,1,30.99,24H448a8,8,0,0,0-8,8v24a8,8,0,0,0,8,8h24v16ZM240,160v48H168V160ZM472,264v8H456v-8Zm16,72H463.42a55.5,55.5,0,0,0-4.83-16H488Z" /&gt;
                &lt;PathGeometry Figures="M256,248h40a8,8,0,0,0,0-16H256a8,8,0,0,0,0,16Z" /&gt;
            &lt;/GeometryGroup&gt;
        &lt;/Setter.Value&gt;
    &lt;/Setter&gt;
&lt;/Style&gt;</code></pre>

  <p>
    Les styles consistent donc principalement à définir la valeur de la propriété <code>Data</code> de nos <code>Path</code>.
  </p>

  <p>
    Pour les utiliser dans nos <code>Views</code>, nous devons d'abord déclarer le dictionnaire de ressource. Soit dans les ressources de la page, soit dans <code>App.xaml</code> si l'on souhaite accéder aux images partout dans le projet (<em>PathesStyles</em> est le nom de mon dictionnaire de ressource).
  </p>
<pre class="line-numbers  language-html"><code>&lt;ContentPage.Resources&gt;
    &lt;ResourceDictionary&gt;
        &lt;ResourceDictionary.MergedDictionaries&gt;
            &lt;pathes:PathesStyles /&gt;
        &lt;/ResourceDictionary.MergedDictionaries&gt;
    &lt;/ResourceDictionary&gt;
&lt;/ContentPage.Resources&gt;</code></pre>

  <p>
    Ensuite, dans la contenu de la page, c'est simple comme <i>Bonjour</i>&nbsp;, on applique le style souhaité à notre path :
  </p>
<pre class="line-numbers  language-html"><code>&lt;Path Style="{StaticResource CarSVG}" /&gt;</code></pre>

  <p>
    Il est toujours possible, bien entendu, de surcharger les valeurs proposées par le style. Pour afficher l'image en rouge par exemple :&nbsp;
  </p>
<pre class="line-numbers  language-html"><code>&lt;Path Style="{StaticResource CarSVG}" Fill="Red" /&gt;</code></pre>

    <figure class="post__image post__image--center">
      <img decoding="async" loading="lazy" src="https://www.sylvainmoingeon.fr/media/posts/39/screenshot-svg.png" height="1250" width="608" alt="Un florilège d'images vectorielles dans Xamarin.Forms"  sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-xs.png 300w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-sm.png 480w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-md.png 768w ,https://www.sylvainmoingeon.fr/media/posts/39/responsive/screenshot-svg-lg.png 1024w">
      <figcaption>Un florilège d'images vectorielles dans Xamarin.Forms</figcaption>
    </figure>

  <p>
    Pour la démo, les valeurs sont en dur dans le code, mais bien entendu toutes les propriétés sont <code>Bindables</code> pour en modifier les valeurs à l'exécution. Votre créativité fera le reste !
  </p>

    <h2 id="projet-github">
      Projet GitHub
    </h2>

  <p>
    Retrouvez la <a href="https://github.com/SylvainMoingeon/SVGDemo" target="_blank">démonstration de l'utilisation des Path Xamarin.Forms pour afficher des images vectorielles</a> dans mon dépôt GitHub.
  </p>

  <p>
    Pensez bien à liker et partager pour que ce soit utile au plus grand nombre !
  </p>          
         </div>
            <aside>
                     <p class="post__last-updated">
                        Mis-à-jour le
                           mercredi 18 novembre 2020
                     </p>
                  <div class="post__share">
                      <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.sylvainmoingeon.fr%2Futiliser-des-images-vectorielles-svg-dans-xamarinforms%2F" class="js-share facebook" title="Facebook" rel="nofollow noopener noreferrer">
                         <svg aria-hidden="true" focusable="false" viewBox="0 0 32 32">
                             <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#facebook" />
                         </svg> Facebook
                     </a>
                     
                     <a href="https://twitter.com/share?url=https%3A%2F%2Fwww.sylvainmoingeon.fr%2Futiliser-des-images-vectorielles-svg-dans-xamarinforms%2F&amp;via=Sylvain%20Moingeon&amp;text=Utiliser%20des%20images%20vectorielles%20SVG%20dans%20Xamarin.Forms
                     " class="js-share twitter" title="Twitter" rel="nofollow noopener noreferrer">
                         <svg aria-hidden="true" focusable="false" viewBox="0 0 32 32">
                             <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#twitter" />
                         </svg> Twitter
                     </a>
                     
                     
                     <a href="https://mix.com/add?url=https%3A%2F%2Fwww.sylvainmoingeon.fr%2Futiliser-des-images-vectorielles-svg-dans-xamarinforms%2F" class="js-share mix" title="Mix" rel="nofollow noopener noreferrer">
                         <svg  aria-hidden="true" focusable="false" viewBox="0 0 32 32">
                             <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#mix" />
                         </svg>  Mix    
                     </a>
                     
                     
                     <a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.sylvainmoingeon.fr%2Futiliser-des-images-vectorielles-svg-dans-xamarinforms%2F&amp;title=Utiliser%20des%20images%20vectorielles%20SVG%20dans%20Xamarin.Forms" class="js-share linkedin" title="LinkedIn" rel="nofollow noopener noreferrer">
                         <svg aria-hidden="true" focusable="false" viewBox="0 0 32 32">
                             <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#linkedin" />
                         </svg> LinkedIn
                     </a>
                     
                     
                        <a
                           href="https://api.whatsapp.com/send?text=Utiliser%20des%20images%20vectorielles%20SVG%20dans%20Xamarin.Forms https%3A%2F%2Fwww.sylvainmoingeon.fr%2Futiliser-des-images-vectorielles-svg-dans-xamarinforms%2F" 
                           class="js-share whatsapp"
                           rel="nofollow noopener noreferrer">
                           <svg aria-hidden="true" focusable="false" viewBox="0 0 32 32">
                              <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#whatsapp"/>
                           </svg> WhatsApp
                        </a>
                  </div>
            </aside>
            <footer>
                     <div class="post__bio">
                           <img src="https://www.gravatar.com/avatar/f0139f72232177b730a57cff5c38c0b2?s&#x3D;240"  loading="lazy" alt="Sylvain">                          
                           <h3>
                              <a href="https://www.sylvainmoingeon.fr/auteurs/sylvain/" class="inverse" title="Sylvain">Sylvain</a>
                           </h3>
                           <p>&lt;p&gt;Un peu geek, diplômé en sciences et en informatique, Sylvain confectionne logiciels et applications depuis 2007.&lt;/p&gt;
&lt;p&gt;Depuis peu il fabrique, répare et règle des guitares classiques, folks et électriques.&lt;/p&gt;
&lt;p&gt;C&#x27;est aussi un père de famille, instructeur de Yoseikan Budo bénévole et musicien amateur.&lt;/p&gt;
                           </p>
                     </div>

                     <ul class="post__tag">
                           <li>
                              <a href="https://www.sylvainmoingeon.fr/tags/svg/">svg</a>
                           </li>
                           <li>
                              <a href="https://www.sylvainmoingeon.fr/tags/xamarinforms/">Xamarin.Forms</a>
                           </li>
                           <li>
                              <a href="https://www.sylvainmoingeon.fr/tags/xaml/">XAML</a>
                           </li>
                     </ul>

                     <nav class="post__nav">
                           <div class="post__nav__prev">
                              Article précédent
                              <h3 class="h5">
                                 <a href="https://www.sylvainmoingeon.fr/creer-un-controle-reutilisable-100-xamarinforms-partie-2/" class="inverse" rel="prev">
                                    Créer un contrôle réutilisable 100% Xamarin.Forms, partie 2
                                 </a>
                              </h5>
                           </div>
                           <div class="post__nav__next">
                              Article suivant
                              <h3 class="h5">
                                 <a href="https://www.sylvainmoingeon.fr/planet-xamarin/" class="inverse" rel="next">
                                    Planet Xamarin
                                 </a>
                              </h5>
                           </div>
                     </nav>

                     <div class="post__related">
                        <h3>
                           Cela vous intéressera peut-être
                        </h3>
                        <div class="post__related__wrap">
                              <figure>
                                      <a href="https://www.sylvainmoingeon.fr/creer-un-controle-reutilisable-100-xamarinforms-partie-2/">
                                         <img 
                                                  src="https://www.sylvainmoingeon.fr/media/posts/37/responsive/micro-assembly-xs.jpg"
                                               loading="lazy"
                                              alt="">
                                      </a>
                                 <figcaption>
                                    <time datetime="2020-11-10T18:22">
                                          mardi 10 novembre 2020
                                    </time>
                                    <h4>
                                       <a href="https://www.sylvainmoingeon.fr/creer-un-controle-reutilisable-100-xamarinforms-partie-2/" class="inverse">Créer un contrôle réutilisable 100% Xamarin.Forms, partie 2</a>
                                    </h4>
                                 </figcaption>
                              </figure>
                              <figure>
                                      <a href="https://www.sylvainmoingeon.fr/creer-un-controle-reutilisable-100-xamarinforms-partie-1/">
                                         <img 
                                                  src="https://www.sylvainmoingeon.fr/media/posts/36/responsive/micro-assembly-xs.jpg"
                                               loading="lazy"
                                              alt="">
                                      </a>
                                 <figcaption>
                                    <time datetime="2020-10-22T12:13">
                                          jeudi 22 octobre 2020
                                    </time>
                                    <h4>
                                       <a href="https://www.sylvainmoingeon.fr/creer-un-controle-reutilisable-100-xamarinforms-partie-1/" class="inverse">Créer un contrôle réutilisable 100% Xamarin.Forms, partie 1</a>
                                    </h4>
                                 </figcaption>
                              </figure>
                              <figure>
                                      <a href="https://www.sylvainmoingeon.fr/xamarinforms-a-quoi-ca-sert-mvvm/">
                                         <img 
                                                  src="https://www.sylvainmoingeon.fr/media/posts/33/responsive/question-mark-xs.jpg"
                                               loading="lazy"
                                              alt="">
                                      </a>
                                 <figcaption>
                                    <time datetime="2020-09-04T19:15">
                                          vendredi 4 septembre 2020
                                    </time>
                                    <h4>
                                       <a href="https://www.sylvainmoingeon.fr/xamarinforms-a-quoi-ca-sert-mvvm/" class="inverse">[Xamarin.Forms] MVVM - A quoi ça sert ?</a>
                                    </h4>
                                 </figcaption>
                              </figure>
                        </div>
                     </div>
            </footer>
      </article>

         <div class="comments wrapper">
            <h3>
               Commentaires
            </h3>
            <div id="disqus_thread">
            <p>
            Pour utiliser les commentaires, merci d'<a href="https://www.sylvainmoingeon.fr/#cookie-settings" title="configuration des cookies">accepter les cookies du groupe "Disqus"</a>.
            </p></div>
            <script type="gdpr-blocker/disqus">
                var disqus_config = function () {
                    this.page.url = 'https://www.sylvainmoingeon.fr/utiliser-des-images-vectorielles-svg-dans-xamarinforms/';
            		this.page.identifier = '39';
                    this.page.title = ' Utiliser des images vectorielles SVG dans Xamarin.Forms';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://artisanlogiciel.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };
            </script>
            <noscript>Veuillez activer javascript pour voir les <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>         </div>
    
    
</main>
</div>
 <footer class="footer">
    <p>       
         <a href="https://www.planetxamarin.com/">Featured by <br />
            <img src="https://www.planetxamarin.com/Content/img/planetxamarin-featured-badge.png" alt="Logo Planet Xamarin" width="180"/>
         </a>
    </p>

      <div class="footer__copyright">
         <p>Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a> - <a href="https://icons8.com/icon/38641/xamarin">using  Xamarin icon by Icons8</a> </p>
<p><a href="../../../../../../../../../../mentions-legales" title="Mention légales">Mentions légales</a> - <a href="../../../../../../../../../../politique-des-commentaires" title="politique des commentaires">Politique des commentaires</a> - <a href="../../../../../../../../../../#cookie-settings" title="configuration des cookies">Configuration des cookies</a> - <a href="../../../../../../../../../../feed.xml">Abonnez vous au flux rss <i class="fas fa-rss"></i></a></p>
      </div>
      <div class="footer__social">
            <a href="https://www.facebook.com/smoingeon" aria-label="Facebook" class="facebook">
               <svg>
                  <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#facebook"/>
               </svg>
            </a>
            <a href="https://twitter.com/SylvainMoingeon" aria-label="Twitter" class="twitter">
               <svg>
                  <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#twitter"/>
               </svg>
            </a>
            <a href="https://www.instagram.com/yoseikanquetigny/" aria-label="Instagram" class="instagram">
               <svg>
                  <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#instagram"/>
               </svg>
            </a>

         <!-- OVERRIDE AT END -->
         <a href="https://dev.to/sylvainmoingeon" style="font-size: 1.2rem; margin:28.8px 7.2px 0px" class="linkedin"> 
            <i class="fab fa-dev" title="sylvainmoingeon's DEV Profile"></i>
         </a>
      </div>
      <button class="footer__bttop js-footer__bttop" aria-label="On remonte tout en haut"> 
         <svg>
            <title>On remonte tout en haut</title>
            <use xlink:href="https://www.sylvainmoingeon.fr/assets/svg/svg-map.svg#toparrow" />
         </svg>
      </button>   
</footer>

<!-- Prism syntax higlighting-->
<script defer src="https://www.sylvainmoingeon.fr/assets/js/prism.js"></script>

<script>
   window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };
</script>
<script defer src="https://www.sylvainmoingeon.fr/assets/js/scripts.min.js?v=18410cbe84c2356f2fa9c4bf730b3bca"></script>
    <script>        
        var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }
    </script>


<!-- Start main cookie container -->
<div 
    class="pcb"
    data-behaviour="badge-link"
    data-behaviour-link="#cookie-settings"
    data-revision="1"
    data-config-ttl="90"
    data-debug-mode="false">
    <!-- Start Banner -->
    <div 
        role="dialog" 
        aria-modal="true" 
        aria-hidden="true" 
        aria-labelledby="pcb-title" 
        aria-describedby="pcb-txt" 
        class="pcb__banner ">
        <div class="pcb__inner">
            <div 
                id="pcb-title" 
                role="heading" 
                aria-level="2" 
                class="pcb__title">
                Ce site web mange des cookies
            </div>
            <div 
                id="pcb-txt" 
                class="pcb__txt">
                Le système de commentaire (Disqus) utilisé sur ce site enregistre des cookies sur votre appareil.

Et c'est tout.
                
            </div>
          
            <div class="pcb__buttons">
                
                <button 
                    type="button" 
                    class="pcb__btn pcb__btn--link pcb__btn--configure" 
                    aria-haspopup="dialog">
                    Manage preferences
                </button>
                
                
                <button 
                    type="button" 
                    class="pcb__btn pcb__btn--solid pcb__btn--accept">
                    Enregistrer
                </button>
            </div>
        </div>
    </div>
    <!-- End of Banner -->

    
    <!-- Start Popup -->
    <div 
        class="pcb__popup" 
        role="dialog" 
        aria-modal="true" 
        aria-hidden="true" 
        aria-labelledby="pcb-popup-title">
        <div class="pcb__popup__wrapper">
            <div class="pcb__inner pcb__popup__inner">
                <div class="pcb__popup__heading">
                    <div 
                        id="pcb-popup-title" 
                        role="heading" 
                        aria-level="2"
                        class="pcb__title">
                        Cookie settings
                    </div>
                    <button class="pcb__popup__close" aria-label="Close"></button>
                </div>
             
                <div class="pcb__popup__content">
                    <div class="pcb__txt pcb__popup__txt">
                        We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies.

                        
                        
                        
                    </div>
                
                    <ul class="pcb__groups">
                        <li class="pcb__group">
                    <details>
                        <summary class="pcb__group__title no-desc">
                            Obligatoire
                        </summary>
                        
                    </details>
                    <div class="pcb__popup__switch is-checked">
                        <input 
                            type="checkbox" 
                            data-group-name=""
                            id="pcb-group-0" 
                            checked />
                        <label for="pcb-group-0">Obligatoire</label>
                    </div>
                </li>
            <li class="pcb__group">
                <details>
                    <summary class="pcb__group__title no-desc">
                        Disqus (système de commentaires)
                    </summary>
                    
                </details>
                <div class="pcb__popup__switch">
                    <input 
                        type="checkbox"
                        data-group-name="disqus"
                        id="disqus-cookies" />
                    <label for="disqus-cookies">
                        Disqus (système de commentaires)
                    </label>
                </div>
            </li>
                    </ul>
                </div>

                <div class="pcb__buttons pcb__popup__buttons">
                    <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button>
                    <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button>
                    <button type="button" class="pcb__btn pcb__btn--save">Save settings</button>
                </div>
            </div>
        </div>
    </div>
    <!-- End of Popup -->
    <!-- Overlay -->
    <div class="pcb__overlay" aria-hidden="true"></div>
    <!-- End of Overlay -->
    

    
    <!-- Badge -->
    <button 
        class="pcb__badge" 
        aria-label="Cookies"
        aria-hidden="true">
        <svg 
            xmlns="http://www.w3.org/2000/svg" 
            aria-hidden="true" 
            focusable="false" 
            width="40" 
            height="40" 
            viewBox="0 0 23 23" 
            fill="currentColor">
            <path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z" />
        </svg>
    </button>
    <!-- End of Badge -->
    
</div>
<!-- End of main cookie container -->

        <script>
            
            (function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && cbConfig.initialLsState.indexOf(allowedGroup) === -1) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('🍪 GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);

        </script>
</body>
</html>
